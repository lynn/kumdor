<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width" />
    <meta property="og:title" content="The Sword of Kumdor">
    <meta name="description" content="English translation of a typing RPG for the PC-98.">
    <meta property="og:description" content="“What's going on!? A spaceship came crashing down! Oh my stars, look at that hole!”">
    <title>The Sword of Kumdor</title>
    <link rel="icon" href="./assets/robot.png" />
    <meta property="og:image" content="./assets/zzz.png" />
    <style>
      * {
        box-sizing: border-box;
      }
      span.patch {
        color: #0a0;
      }
      span.comment {
        color: #888;
        font-style: italic;
      }
      body {
        margin: 0px;
        /* image-rendering: pixelated; */
        /* -webkit-font-smoothing: none; */
        font-size: 18px;
        /* font-family: PC98, monospace; */
        font-family: Meiryo, "ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro",
          Osaka, sans-serif;
        background: url("assets/light.png") repeat;
        background-attachment: fixed;
      }
      a {
        text-decoration: underline;
      }
      a:hover {
        text-decoration: doubleunderline;
      }
      a:visited {
        color: #c000c0;
      }
      h1:first-child,
      h2:first-child {
        margin-top: 0;
      }
      .container {
        max-width: 850px;
        margin: auto;
      }
      .box {
        position: relative;
        padding: 2rem 3rem;
        margin: 3rem 0rem;
        background: #fafafa;
        border: 2px solid black;
      }
      img {
        image-rendering: pixelated;
      }
      figure > img {
        image-rendering: inherit;
      }
      p > img {
        float: left;
        padding: 0px 16px 0px 0px;
      }
      p > img.r {
        float: right;
        padding: 0px 0px 0px 16px;
      }
      code {
        background: #50000020;
        padding: 2px 8px;
      }
      pre {
        background: #50000020;
        padding: 8px 24px;
        font-size: 15px;
      }

      .box::after {
        content: "";
        position: absolute;
        left: 16px;
        top: 16px;
        z-index: -1;
        width: 100%;
        height: 100%;
        background: url("assets/dark.png") repeat;
        background-attachment: fixed;
      }

      figure {
        text-align: center;
        margin: 2em 0;
      }
      figure > img {
        outline: 2px solid black;
      }
      ruby > rt {
        font-size: 14px;
      }
      pre {
        white-space: pre-wrap;
      }
      summary {
        cursor: pointer;
      }
      summary:hover {
        text-decoration: underline;
      }
      table {
        border-collapse: collapse;
      }
      th {
        border-top: 2px solid black;
        border-bottom: 2px solid black;
        padding: 6px 12px;
      }
      td {
        border-top: 1px solid black;
        border-bottom: 1px solid black;
        padding: 6px 12px;
      }
      @media screen and (max-width: 900px) {
        .box {
          margin: 0;
          border: none;
          overflow: hidden;
        }
        .box::after {
          width: 0px;
          height: 0px;
        }
        .container {
          max-width: inherit;
        }
        img {
          max-width: 100%;
          max-height: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="box">
        <!-- <p style="float:right;background:#ffc;padding:1em"><a href="#patch">Gimme the patch!</a></p> -->
        <h1>The Sword of Kumdor</h1>
        <blockquote
          style="font-size: 14px; font-style: italic; text-align: right"
        >
          “What's going on!? A spaceship came crashing down! Oh my stars, look
          at that hole!”
        </blockquote>
        <p>
          <img class="l" src="assets/hmm.png" height="64" /> “The Sword of
          Kumdor” (クムドールの剣) is a touch-typing RPG for the
          NEC&nbsp;PC&#x2011;98, created by Michiaki Tsubaki in 1991. You play as
          the Milky&nbsp;Way's #1&nbsp;typist, summoned to planet Kumdor to
          fight mysterious monsters by typing spells — but you lose all your
          keyboard keys <em>and</em> your QWERTY skills in a crash landing. Can
          you recover your talents and save the world??
        </p>
        <p>
          <img class="r" src="assets/ship.png" height="128" /> The game has a
          surreal atmosphere, quirky dialogue, and a distinctive visual style.
          Japanese fansites call it “my&nbsp;favorite childhood RPG” and
          “an&nbsp;underrated masterpiece.” I think it deserves more
          recognition, so I translated the game to English.
        </p>
        <figure>
          <img src="assets/screen3.png" width="640" alt="Arriving on planet
          Kumdor. The player is in a crater created by their own crashed
          spaceship. A villager says: 'Look, there's someone in there. Are they
          alive? ...'"" />
        </figure>
        <p>
          <img class="l" src="assets/ponder.png" height="64" /><i>Kumdor</i> has
          the strangest control scheme ever. Outside of combat and
          spell-casting, only the <code>F</code>, <code>J</code>, and
          <code>Space</code> keys are used, so as to keep even a novice typist's
          hands in the home row position at all times. <code>F</code> walks
          forward and <code>Space</code> turns you 90° clockwise. You get used
          to it, sorta.
        </p>
      </div>
      <div class="box" style="background: #ffc">
        <h2 id="patch">The patch</h2>
        <p style="text-align: center; font-size: 24px">
          Download the translation patch
          <a href="kumdor-english.xdelta" download><strong>here</strong></a
          >.
        </p>
        <p>
          <img class="l" src="assets/hero.png" height="64" /> The translation is
          released as an <a href="http://xdelta.org/">xDelta</a> patch. To apply
          it, I suggest you use
          <a href="https://www.romhacking.net/utilities/598/">xdelta&nbsp;UI</a
          >, but if you prefer using the command line, try:
        </p>
        <pre>
xdelta -d -s "The Sword of Kumdor.hdm" kumdor-english.xdelta kumdor-english.hdm</pre
        >
        <p>
          <img class="r" src="assets/machine.png" height="128" />
          To run the patched game in an emulator, load it into FDD Slot #1 and
          reboot. You will need BIOS files (specifically <code>SOUND.ROM</code>)
          placed in the emulator folder,
          <strong>or else the game crashes</strong> when you walk out of the
          tutorial.
        </p>
        <h3>On typing funny symbols</h3>
        <p>
          <img class="l" src="assets/rhand.png" height="64" />Your keyboard
          likely has fewer keys than the JIS keyboard used by the PC-98. As
          such, when playing in an emulator, you may have trouble typing
          <code>^</code> and <code>_</code>. In Neko Project II, you can use the
          on-screen keyboard, or create a text file next to
          <code>np21w.exe</code> called <code>key.txt</code> with the following
          contents:
        </p>
        <pre>
TAB = ^
CTRL = SHIFT _</pre
        >
        <p>
          Now you can type these symbols by pressing Tab and Ctrl. In general,
          the layout of punctuation is different, so you may have to relearn
          some of the locations. (This might be a bit frustrating, but by the
          end, you will have actually mastered the PC-98 keyboard layout, which
          is the point of the game!)
        </p>
        <figure>
          <img
            src="assets/screen2.png"
            width="640"
            alt="Fighting a monster in Sword of Kumdor. Text on the screen reads, 'A monster appears! Eff is casting a spell. 9 points of damage to your opponent!' The player types back spells like 'dasafaa dasafaa' using the keyboard to defeat monsters."
          />
        </figure>
      </div>
      <div class="box">
        <h2>Links</h2>
        <p>
          <img class="r" src="assets/down.png" height="64" />If you've never
          emulated PC-98 games before,
          <a href="https://gang-fight.com/projects/98faq/"
            ><i>PC-98 Emulation For Beginners</i></a
          >
          is a great resource.
        </p>
        <p>
          My playtesting was greatly assisted by
          <a href="http://rocky75.web.fc2.com/kumu/">rocky75's fan site</a>,
          which contains a thorough
          <a href="http://rocky75.web.fc2.com/kumu/0.txt">tutorial</a> in
          Japanese. If you're stuck, I suggest referring to it with the help of
          your favorite machine translation service.
        </p>
        <p>
          I found
          <a href="assets/kumap.jpg">this overworld map (spoiler!)</a> floating
          around on the Internet.
        </p>
        <p>
          You can browse
          <a href="https://archive.org/details/KumdolNoKenMac"
            >the Mac version's manual</a
          >: also in Japanese, but contains plenty of cute illustrations.
          (Kumdor was released as a book with the game floppies on the inside.)
        </p>
        <p>
          <img class="l" src="assets/robot.png" height="64" />
          Finally, there's my
          <a href="https://github.com/lynn/kumdor">code repository</a>, where
          all the translating and patch-writing and sprite-dumping happens.
        </p>
      </div>
      <div class="box">
        <h2>Translation points</h2>
        <p>
          <img class="l" src="assets/sit.png" height="64" />To make a delicious
          keyboard/fruit pun, I translated
          <ruby>クムの木<rt>Kum tree</rt></ruby>
          as "keytree", so that <ruby>クムの実<rt>Kum fruit</rt></ruby> could be
          "keylime". That makes <ruby>クム酒<rt>Kum-shu</rt></ruby> "keywine".
        </p>
        <p>
          <img class="r" src="assets/vane.png" height="64" />The "whithervane"
          is called <ruby>風見ダヌキ<rt>kazami-danuki</rt></ruby>
          (weather-seeing tanuki) in Japanese, which is a play on the actual
          word for a weather-vane,
          <ruby>風見鶏<rt>kazami-dori</rt></ruby> (weather-seeing chicken, like
          "weathercock").
        </p>
        <p>
          I think the <ruby>ダイビング<rt>diving</rt></ruby> equipment shop that
          pivots into a <ruby>タイピング<rt>typing</rt></ruby> equipment shop is
          a visual kana pun.
        </p>
        <p>
          Fivetown is called <ruby>ヨゴンナ<rt>Yogonna</rt></ruby> in Japanese,
          which is
          <a href="https://en.wikipedia.org/wiki/Japanese_wordplay#Goroawase"
            >goroawase</a
          >
          for 4567, the keys found there.
        </p>
        <p>
          Translating the spells was interesting: there's no way to do it
          without affecting the game balance. For example, to cast
          <code>CURE</code>, you need a different set of keyboard keys than for
          the original <code>NAOSU</code>. (Thankfully spells are just not very
          useful anyway! Shop items are easier to get and just as good.)
        </p>
        <p>
          <img class="l" src="assets/hero2.png" height="64" /> <i>Kumdor</i>
          came out two years after the highly successful release of
          <i>Mother</i> for the Famicom. There are some similar themes: an alien
          invader causes chaos on a modern low-fantasy planet, RPG tropes are
          subverted and riffed on, and all is resolved in a slightly psychedelic
          final encounter. I can't say for certain what inspired Tsubaki, but
          some of the "mundanely funny" dialogue in this game reminds me of
          Shigesato Itoi's style. I often kept the quirky, matter-of-factly
          voice of EarthBound's localization in the back of my mind when writing
          this translation.
        </p>
        <!--<details>
          <summary>Spoilers!</summary>
          <p>
            In the last dungeon, you meet nine strange foes that aren't named
            after letters or punctuation. They have interesting names and
            absolutely crazy designs. Translating their names was kind of like
            translating Pokémon.
          </p>
          <figure>
            <img src="kumdor-boss.png" alt="The Minibosses of Kumdor." />
          </figure>
          <table style="margin: auto">
            <thead>
              <tr>
                <th>Row</th>
                <th>Japanese</th>
                <th>Interpretation</th>
                <th>English</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="3">Top</td>
                <td>Hidama</td>
                <td>火玉 "fireball"</td>
                <td>Firesoul</td>
              </tr>
              <tr>
                <td>Bō</td>
                <td>棒 "stick"</td>
                <td>Stix</td>
              </tr>
              <tr>
                <td>Senju</td>
                <td>千手 "thousand-armed bodhisattva"</td>
                <td>Thoushand</td>
              </tr>
              <tr>
                <td rowspan="3">Middle</td>
                <td>Kasumi</td>
                <td>霞 "mist, haze"</td>
                <td>Haze</td>
              </tr>
              <tr>
                <td>Uzumaneki</td>
                <td>渦巻 "spiral" + 招き "beckon"</td>
                <td>Spiralure</td>
              </tr>
              <tr>
                <td>Modoki</td>
                <td>もどき "mock, pseudo"</td>
                <td>Mimicky</td>
              </tr>
              <tr>
                <td rowspan="3">Bottom</td>
                <td>Ōnetsu</td>
                <td>大 "big" + 熱 "heat"</td>
                <td>Heatwave</td>
              </tr>
              <tr>
                <td>Ishime</td>
                <td>石目 "grain (of rock)", lit. rock + eye</td>
                <td>Eyeron</td>
              </tr>
              <tr>
                <td>Ryū</td>
                <td>龍 "dragon"</td>
                <td>Qilin</td>
              </tr>
            </tbody>
          </table>
        </details>-->
      </div>
      <div class="box">
        <h2 id="how">How I made this</h2>
        <div>
          <!-- <summary>Technobabble</summary> -->
          <!-- <h3 id="how">Tools</h3> -->
          <p>
            <img class="l" src="assets/diamond.png" height="64" />This
            translation is my first ever romhacking project. I had a lot of fun!
            I used <a href="https://github.com/nmlgc/np2debug">np2debug</a>,
            <a href="https://ghidra-sre.org/">Ghidra</a>, a hex editor, and
            Python. For translation, I relied on my own Japanese-reading and
            English-writing skills.
          </p>
          <h3>Patching text</h3>
          <p>
            <i>Kumdor</i> has a weird custom file system, so I had to treat the
            ROM as a unit rather than dumping files from it. Thankfully, the
            text is almost all consolidated in uncompressed sections of
            null-separated Shift-JIS data, so finding and dumping and
            reimporting it was super easy. Writing translations took about a
            month and a half. The game text is about 7,200 words in English.
          </p>
          <figure>
            <img
              src="assets/tl.png"
              style="max-width: 100%"
              alt="Translating text strings."
            />
          </figure>

          <h3>"Touch typing" means...</h3>
          <p>
            This intro was difficult to translate. The handwritten text is
            stored as thousands of little line segment coordinates in a strange
            data layout. I reverse-engineered the format by corrupting the data
            in weird ways and seeing what happens. Then I programmed a tool for
            editing this format, and handwrote a translation with a tablet pen.
            (You can see the process
            <a href="https://twitter.com/chordbug/status/1598341221008687104"
              >here</a
            >.)
          </p>
          <figure>
            <img
              src="assets/intro.png"
              style="max-width: 100%"
              alt="Left: the untranslated tutorial. Right: my handwritten translation."
            />
          </figure>

          <h3>Removing copy protection</h3>
          <p>
            The popular dump of this game that floats around online triggers a
            copy protection check that freezes the game right before the final
            dungeon! I never really bothered to figure out what exactly it's
            checking. I used a debugger and Ghidra to find the instruction
            responsible for locking up the game, and disabled it.
          </p>
          <figure>
            <img
              src="assets/ghidra.png"
              style="max-width: 100%"
              alt="Looking at disassembled source code in Ghidra."
            />
          </figure>
          <h3>An overly elaborate grammar fix</h3>
          <p>
            <img class="r" src="assets/computer.png" height="64" /> When picking
            up an item, the game joins two strings together with code somewhat
            like this:
          </p>
          <pre>pick_up_item:
  ...
  mov di, 0xc000            <span class="comment">// Reset the message buffer</span>
  <span style="color: #09f">mov cl, al                <span class="comment">// Load the item ID</span>
  call write_item_name      <span class="comment">// Append its name to the buffer</span></span>
  <span style="color: #a0f">mov cl, 0x1b              <span class="comment">// Index of "を拾った。"</span>
  call write_common_string  <span class="comment">// Append to the buffer</span></span>
  ...</pre>
          <p>
            This builds a string like
            <code
              >"<span style="color: #09f">呪文書</span
              ><span style="color: #a0f">を拾った。</span>"</code
            >, which I can only translate part-by-part as
            <code >"<span style="color: #09f">scroll</span ><span style="color:
            #a0f"> was obtained.</span>"</code >. The grammar is awkward, and as
            a full sentence, it's missing capitalization.
          </p>
          <p>
            Dissatisfied, I got my hands dirty and wrote some assembly patches to
            print my own bits of text. I had to figure out a way to inject code
            of my own without moving any of the surrounding code, as that would
            dislocate a bunch of pointers.
          </p>
          <pre>pick_up_item:
  ...
  <s style="color: #c00">mov di, 0xc000</s>            <span class="comment">// Overwrite a 3-byte instruction here</span>
  <span class="patch">call you_got_a            <span class="comment">// Call my cool new subroutine instead</span></span>
  <span style="color: #09f">mov cl, al
  call write_item_name</span>
  <span style="color: #a0f">mov cl, 0x1b              <span class="comment">// I've translated "を拾った。" as "."</span>
  call write_common_string</span>
  ...

<span class="comment">// Far, far away, in a blank region of ROM:</span>

<span class="patch">you_got_a:
  <span style="color:black">mov di, 0xc000            <span class="comment">// The instruction we overwrote</span></span>
  push ax
  mov cl, 0x60              <span class="comment">// Index of "You got a "  (my new string)</span>
  call write_common_string  <span class="comment">// Append to the buffer</span>
  pop ax
  ret</span></pre>
          <p>
            All to get nice messages like
            <code
              ><span class="patch">"You got a </span
              ><span style="color: #09f">scroll</span
              ><span style="color: #a0f">.</span>"</code
            >. It was totally worth it.
          </p>
        </div>
      </div>
      <div class="box">
        <h2>Thanks</h2>
        <ul>
          <li>PasokonDeacon, for playtesting and providing errata.</li>
          <li>SpeedyNoelle, for helping me get the game running at all.</li>
          <li>
            The PC-9800 Series Central Discord, for encouraging me to finish
            this thing.
          </li>
          <li>fluidvolt, for everything &lt;33</li>
        </ul>
      </div>

      <div class="box">
        <h2>Bonus: Music</h2>
        <p>
          <img class="l" src="assets/guy.png" height="64" />The game's
          soundtrack is a bit <em>outré</em> so I turned it off after an hour or
          so. I listened to suitably psychedelic electronic music instead and I
          can highly recommend this. For example:
        </p>
        <ul>
          <li>BBC Radiophonic Workshop</li>
          <li>Boards of Canada</li>
          <li>Gershon Kingsley</li>
          <li>Mort Garson</li>
          <li>Plone</li>
          <li>Raymond Scott</li>
        </ul>
        <p>
          <img class="r" src="assets/zzz.png" height="64" />Sorry, let me
          collapse somewhere out of your way.
        </p>
        <p style="text-align: right">— <a href="https://foldr.moe">Lynn</a></p>
      </div>
    </div>
  </body>
</html>
